<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>DNV反馈</title>
  <link rel="icon" href="data:," />
  <script>
    window.MathJax = {
      tex: {
        inlineMath: [['\\(', '\\)'], ['$', '$']],
        displayMath: [['\\[', '\\]']]
      },
      options: {
        skipHtmlTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
      }
    };
  </script>
  <script defer src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
  <style>
    :root {
      --bg-1: #edf3fb;
      --bg-2: #f8fbff;
      --panel: #ffffff;
      --ink: #182433;
      --muted: #5b6778;
      --line: #d9e2ef;
      --brand: #0f63bf;
      --brand-2: #0c4f95;
      --must: #a1262a;
      --should: #9f6200;
      --plus: #1f7a4c;
      --ok: #12764f;
      --warn: #9f5a00;
    }

    html { scroll-behavior: smooth; }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      color: var(--ink);
      font-family: "Avenir Next", "Segoe UI", -apple-system, BlinkMacSystemFont, system-ui, sans-serif;
      line-height: 1.56;
      background:
        radial-gradient(circle at 0% 0%, #ffffff 0%, var(--bg-1) 58%),
        linear-gradient(150deg, var(--bg-1) 0%, var(--bg-2) 100%);
    }

    .wrap {
      max-width: 1160px;
      margin: 0 auto;
      padding: 24px 18px 34px;
    }

    .hero {
      position: relative;
      background: linear-gradient(120deg, #0c5eb8 0%, #1f83e2 100%);
      color: #fff;
      border-radius: 16px;
      padding: 22px 22px 18px;
      box-shadow: 0 12px 28px rgba(11, 78, 152, 0.24);
      overflow: hidden;
    }

    .hero::after {
      content: "";
      position: absolute;
      right: -60px;
      top: -40px;
      width: 220px;
      height: 220px;
      border-radius: 50%;
      background: rgba(255,255,255,0.11);
    }

    .hero h1 {
      margin: 0 0 6px;
      font-size: clamp(1.25rem, 2.3vw, 1.82rem);
      letter-spacing: 0.2px;
      position: relative;
      z-index: 1;
    }

    .hero p {
      margin: 0;
      opacity: 0.95;
      max-width: 900px;
      position: relative;
      z-index: 1;
    }

    .toolbar {
      margin: 12px 0 18px;
      display: flex;
      flex-wrap: wrap;
      gap: 9px;
      align-items: center;
    }

    button {
      border: 1px solid var(--line);
      background: var(--panel);
      color: var(--ink);
      border-radius: 10px;
      padding: 8px 12px;
      font-weight: 650;
      cursor: pointer;
      transition: transform .09s ease, box-shadow .12s ease;
    }

    button:hover {
      transform: translateY(-1px);
      box-shadow: 0 4px 10px rgba(0,0,0,0.08);
    }

    .btn-primary {
      background: var(--brand);
      color: #fff;
      border-color: var(--brand-2);
    }

    .btn-toggle {
      background: #0e3f77;
      color: #fff;
      border-color: #0a315d;
    }

    .status {
      font-size: .9rem;
      color: var(--muted);
      margin-left: 2px;
    }

    .status.ok { color: var(--ok); }
    .status.warn { color: var(--warn); }

    .github-star-link {
      display: inline-flex;
      align-items: center;
      gap: 7px;
      border: 1px solid #0a315d;
      background: #111827;
      color: #fff;
      border-radius: 10px;
      padding: 8px 12px;
      font-weight: 650;
      text-decoration: none;
      transition: transform .09s ease, box-shadow .12s ease;
    }

    .github-star-link:hover {
      transform: translateY(-1px);
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.18);
    }

    .github-star-link svg {
      width: 16px;
      height: 16px;
      fill: currentColor;
      flex-shrink: 0;
    }

    .reading-layout {
      display: grid;
      grid-template-columns: 260px minmax(0, 1fr);
      gap: 16px;
      align-items: start;
    }

    .map-panel {
      position: sticky;
      top: 14px;
    }

    .map-card {
      background: var(--panel);
      border: 1px solid var(--line);
      border-radius: 12px;
      box-shadow: 0 3px 10px rgba(16, 37, 68, 0.05);
      padding: 12px;
    }

    .map-title {
      margin: 0 0 6px;
      font-size: 0.95rem;
      color: #214a75;
    }

    .map-note {
      margin: 0 0 10px;
      font-size: 0.84rem;
      color: var(--muted);
      line-height: 1.45;
    }

    .map-links {
      display: grid;
      gap: 7px;
    }

    .map-links a {
      text-decoration: none;
      color: #1e456d;
      border: 1px solid #d7e3f3;
      background: #f8fbff;
      border-radius: 8px;
      padding: 7px 9px;
      font-size: 0.89rem;
      line-height: 1.3;
      transition: background .12s ease, border-color .12s ease;
    }

    .map-links a:hover {
      background: #eef5ff;
      border-color: #b9d0ee;
    }

    .map-lang { display: none; }
    .map-lang.active { display: block; }

    .content-column {
      min-width: 0;
      max-width: 900px;
    }

    .lang-pane { display: none; }
    .lang-pane.active { display: block; }

    .overview-grid {
      display: grid;
      grid-template-columns: repeat(4, minmax(0, 1fr));
      gap: 9px;
      margin-bottom: 10px;
    }

    .overview-card {
      border: 1px solid var(--line);
      border-radius: 11px;
      padding: 10px;
      background: #fbfdff;
    }

    .overview-k {
      font-size: 0.78rem;
      text-transform: uppercase;
      letter-spacing: .3px;
      color: var(--muted);
      margin: 0 0 4px;
    }

    .overview-v {
      margin: 0;
      font-weight: 700;
      color: #173f69;
      font-size: 0.98rem;
      line-height: 1.32;
    }

    .section {
      background: var(--panel);
      border: 1px solid var(--line);
      border-radius: 14px;
      padding: 16px;
      margin-bottom: 14px;
      box-shadow: 0 3px 10px rgba(16, 37, 68, 0.05);
      scroll-margin-top: 18px;
    }

    .section h2 {
      margin: 0 0 8px;
      font-size: 1.18rem;
      color: #153f69;
    }

    .section h3 {
      margin: 14px 0 8px;
      font-size: 1.01rem;
      color: #1d4f82;
    }

    .tag {
      display: inline-block;
      border-radius: 999px;
      color: #fff;
      font-size: .78rem;
      font-weight: 700;
      padding: 2px 10px;
      margin-left: 8px;
      vertical-align: middle;
    }

    .must { background: var(--must); }
    .should { background: var(--should); }
    .plus { background: var(--plus); }

    .priority-must { border-top: 4px solid var(--must); }
    .priority-should { border-top: 4px solid var(--should); }
    .priority-plus { border-top: 4px solid var(--plus); }

    .item {
      border: 1px solid var(--line);
      border-radius: 12px;
      background: #fbfdff;
      padding: 12px;
      margin-top: 10px;
    }

    .meta {
      color: var(--muted);
      font-size: .92rem;
      margin: 4px 0;
    }

    .meta strong { color: #2b3e55; }

    ul { margin: 8px 0 0 18px; }
    li { margin: 4px 0; }

    .template {
      margin-top: 10px;
      border: 1px dashed #b6cae3;
      border-radius: 10px;
      padding: 10px;
      background: #f2f8ff;
    }

    .template-head {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
      margin-bottom: 8px;
      color: #345679;
      font-size: .92rem;
    }

    .latex-preview {
      border: 1px solid #d9e6f7;
      border-radius: 9px;
      padding: 10px;
      background: #ffffff;
      color: #17314f;
      font-size: .94rem;
      line-height: 1.55;
      white-space: pre-wrap;
      word-break: break-word;
      margin-bottom: 8px;
    }

    .source-wrap {
      display: none;
      margin-top: 6px;
    }

    .source-wrap textarea {
      min-height: 180px;
    }

    .source-dock {
      position: fixed;
      right: 14px;
      bottom: max(12px, env(safe-area-inset-bottom));
      width: min(620px, calc(100vw - 24px));
      max-height: 64vh;
      z-index: 1200;
      border: 1px solid #c6d8ee;
      border-radius: 14px;
      background: #f7fbff;
      box-shadow: 0 16px 38px rgba(8, 42, 82, 0.28);
      padding: 10px;
      transform: translateY(calc(100% + 20px));
      opacity: 0;
      pointer-events: none;
      transition: transform .2s ease, opacity .2s ease;
    }

    .source-dock.open {
      transform: translateY(0);
      opacity: 1;
      pointer-events: auto;
    }

    .source-dock-head {
      display: flex;
      align-items: flex-start;
      justify-content: space-between;
      gap: 10px;
      margin-bottom: 8px;
    }

    .source-dock-head-text {
      min-width: 0;
    }

    .source-dock-kicker {
      margin: 0 0 3px;
      font-size: 0.74rem;
      letter-spacing: .3px;
      color: #5a6f86;
      text-transform: uppercase;
    }

    .source-dock-title {
      margin: 0;
      font-size: 0.98rem;
      color: #1b466f;
      line-height: 1.3;
      word-break: break-word;
    }

    .source-dock-note {
      margin: 3px 0 0;
      color: #5c6f84;
      font-size: 0.83rem;
      line-height: 1.35;
    }

    .source-dock-actions {
      display: flex;
      gap: 6px;
      flex-shrink: 0;
    }

    .source-dock-code {
      margin: 0;
      border: 1px solid #d4e2f1;
      border-radius: 10px;
      background: #ffffff;
      color: #14293e;
      padding: 10px;
      overflow: auto;
      max-height: 46vh;
      white-space: pre-wrap;
      word-break: break-word;
      font-family: "JetBrains Mono", "Menlo", "Consolas", monospace;
      font-size: 0.82rem;
      line-height: 1.4;
    }

    textarea {
      width: 100%;
      min-height: 120px;
      border: 1px solid var(--line);
      border-radius: 9px;
      background: #fff;
      color: #162437;
      padding: 9px;
      resize: vertical;
      font-family: "JetBrains Mono", "Menlo", "Consolas", monospace;
      font-size: .86rem;
      line-height: 1.43;
    }

    .note {
      margin-top: 10px;
      padding: 10px;
      border-left: 4px solid #8cb0d8;
      border-radius: 0 8px 8px 0;
      background: #f5f9ff;
      color: #2a4767;
      font-size: .95rem;
    }

    footer {
      margin-top: 14px;
      color: var(--muted);
      font-size: .9rem;
    }

    @media (max-width: 980px) {
      .reading-layout {
        grid-template-columns: 1fr;
      }

      .map-panel {
        position: static;
      }

      .map-links {
        grid-template-columns: repeat(2, minmax(0, 1fr));
      }
    }

    @media (max-width: 760px) {
      .wrap { padding: 14px 12px 24px; }
      .hero { padding: 16px 14px 14px; }
      .section { padding: 12px; }
      .toolbar { gap: 7px; }
      button { padding: 7px 10px; }
      .overview-grid { grid-template-columns: repeat(2, minmax(0, 1fr)); }
      .map-links { grid-template-columns: 1fr; }

      .source-dock {
        left: 8px;
        right: 8px;
        width: auto;
        max-height: 70vh;
        padding: 9px;
      }

      .source-dock-head {
        flex-direction: column;
        align-items: stretch;
      }

      .source-dock-actions {
        justify-content: flex-end;
      }

      .source-dock-code {
        max-height: 43vh;
        font-size: 0.8rem;
      }
    }
  </style>
</head>
<body>
  <div class="wrap">
    <header class="hero">
      <h1 id="hero-title">DNV反馈</h1>
      <p id="hero-subtitle">MDM3___DNV (15).pdf</p>
    </header>

    <div class="toolbar">
      <button class="btn-toggle" id="lang-toggle">切换中文</button>
      <button id="source-toggle">Open Floating Source Dock</button>
      <a
        id="github-star-link"
        class="github-star-link"
        href="https://github.com/zhouyi-xiaoxiao/mdm3-dnv6-feedback-copy-page"
        target="_blank"
        rel="noopener noreferrer"
        aria-label="Star this project on GitHub"
      >
        <svg viewBox="0 0 16 16" aria-hidden="true">
          <path d="M8 0C3.58 0 0 3.67 0 8.2c0 3.62 2.29 6.69 5.47 7.77.4.08.55-.18.55-.4 0-.2-.01-.86-.01-1.56-2.01.44-2.53-.5-2.69-.96-.09-.24-.48-.96-.82-1.15-.28-.16-.68-.54-.01-.55.63-.01 1.08.59 1.23.84.72 1.24 1.87.89 2.33.68.07-.54.28-.89.5-1.09-1.78-.21-3.64-.92-3.64-4.08 0-.9.31-1.64.82-2.22-.08-.21-.36-1.06.08-2.2 0 0 .67-.22 2.2.85.64-.18 1.32-.28 2-.28.68 0 1.36.1 2 .28 1.53-1.07 2.2-.85 2.2-.85.44 1.14.16 1.99.08 2.2.51.58.82 1.31.82 2.22 0 3.17-1.87 3.87-3.65 4.08.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.19 0 .22.15.49.55.4A8.16 8.16 0 0 0 16 8.2C16 3.67 12.42 0 8 0Z"></path>
        </svg>
        <span id="github-star-text">Star on GitHub</span>
      </a>
      <span id="status" class="status">Ready.</span>
    </div>

    <div class="reading-layout">
      <aside class="map-panel">
        <div class="map-card map-lang map-en active" id="map-en">
          <h3 class="map-title">Reading Map</h3>
          <p class="map-note">Start with priorities, then paste-ready blocks, then final checklist.</p>
          <nav class="map-links">
            <a href="#en-at-a-glance">At a Glance</a>
            <a href="#en-overall">Overall Assessment</a>
            <a href="#en-rescan">Rescan Confirmation</a>
            <a href="#en-must">Must-Fix Revisions</a>
            <a href="#en-recommended">Recommended Improvements</a>
            <a href="#en-optional">Optional Add-on</a>
            <a href="#en-checklist">Submission Checklist</a>
          </nav>
        </div>

        <div class="map-card map-lang map-zh" id="map-zh">
          <h3 class="map-title">阅读导航</h3>
          <p class="map-note">先看优先级，再看可粘贴模板，最后对照提交清单。</p>
          <nav class="map-links">
            <a href="#zh-at-a-glance">一页总览</a>
            <a href="#zh-overall">总体评价</a>
            <a href="#zh-rescan">复扫确认</a>
            <a href="#zh-must">必改项</a>
            <a href="#zh-recommended">建议改进项</a>
            <a href="#zh-optional">可选加分项</a>
            <a href="#zh-checklist">提交前自检</a>
          </nav>
        </div>
      </aside>

      <div class="content-column">

    <!-- English Pane -->
    <main id="pane-en" class="lang-pane active">
      <section class="section" id="en-at-a-glance">
        <h2>At a Glance</h2>
        <div class="overview-grid">
          <article class="overview-card">
            <p class="overview-k">Must-Fix</p>
            <p class="overview-v">5 High-Priority Fixes</p>
          </article>
          <article class="overview-card">
            <p class="overview-k">Recommended</p>
            <p class="overview-v">2 Strengthening Actions</p>
          </article>
          <article class="overview-card">
            <p class="overview-k">Optional</p>
            <p class="overview-v">2 High-Value Add-ons</p>
          </article>
          <article class="overview-card">
            <p class="overview-k">Paste-Ready Blocks</p>
            <p class="overview-v">6 Copyable Templates</p>
          </article>
        </div>
        <div class="note">Coverage check: this revision includes all items from your 2026-02-11 feedback plus additional PDF-level corrections identified from <code>MDM3___DNV (15).pdf</code>.</div>
      </section>

      <section class="section" id="en-overall">
        <h2>Overall Assessment</h2>
        <p>The report narrative is close to complete, but three breaks still weaken the argument chain.</p>
        <ul>
          <li><strong>Breakpoint A (damping sign):</strong> the sign convention for \(W\), the figure axis label, and the wording in Results/Conclusion are not yet fully aligned.</li>
          <li><strong>Breakpoint B (rigid vs flexible evidence):</strong> some paragraphs mix rigid prescribed-motion and flexible dataset conclusions in one statement.</li>
          <li><strong>Breakpoint C (cross-references):</strong> unresolved references (for example <code>Section ??</code>, <code>Appendix A.8</code>, and a wrong figure number) reduce credibility immediately.</li>
        </ul>
        <p>Fixing these three breaks will make the technical story much more defensible for marking and for an external engineering audience.</p>
      </section>

      <section class="section" id="en-rescan">
        <h2>Rescan Confirmation</h2>
        <p class="meta"><strong>Page numbering note:</strong> this guide uses both PDF-viewer page numbers and footer page numbers. We write them as <code>PDF p.X (footer p.Y)</code>. In this file, footer numbering starts after cover + abstract, so it is typically <code>Y = X - 2</code>.</p>
        <p class="meta"><strong>Scope:</strong> second-pass check on <code>MDM3___DNV (15).pdf</code> using page-by-page text extraction.</p>
        <p class="meta"><strong>Confirmed from PDF text:</strong></p>
        <ul>
          <li>p.5 still contains <code>Section??</code>.</li>
          <li>p.11 still references <code>Appendix A.8</code> for spectral baselines (should point to Appendix A.4 figures).</li>
          <li>p.10 Section 4.2 rigid-case paragraph still says <code>Figure 10</code> where context indicates Figure 3.</li>
          <li>p.2 Abstract still says flexible open-source data <code>[1]</code>.</li>
          <li>p.8 still has visible language defects: <code>conditions..</code>, <code>component is remains governed</code>, <code>10%The</code>.</li>
          <li>Ref [21] still contains <code>Constractor</code>.</li>
        </ul>
        <p class="meta"><strong>Removed as unconfirmed:</strong> the previous abstract spacing/glued-token warning was removed because it is not reliably verifiable from visual inspection.</p>
        <p class="meta"><strong>Requires visual (non-text) verification in the PDF viewer:</strong></p>
        <ul>
          <li>Whether Figure 3 y-axis label is still "Negative Damping" and whether \(W=0\) guide line is absent.</li>
          <li>Whether Figure 2-4 captions are still near-identical and under-specified.</li>
          <li>Any axis clipping / cropped labels in work-per-cycle figures.</li>
        </ul>
      </section>

      <section class="section priority-must" id="en-must">
        <h2>Must-Fix Revisions <span class="tag must">HIGH PRIORITY</span></h2>
        <p class="meta">These points should be addressed first. They directly impact presentation quality, technical consistency, and trust in the conclusions.</p>

        <article class="item">
          <h3>1.1) Resolve placeholder and cross-reference errors</h3>
          <p class="meta"><strong>Locations:</strong> p.5 (<code>Section ??</code>), p.11 (<code>Appendix A.8</code>), p.10 (<code>Figure 10</code> in rigid-case text).</p>
          <ul>
            <li>Replace <code>Section ??</code> with the actual limitations section reference.</li>
            <li>Replace <code>Appendix A.8</code> with <code>Appendix A.4, Figures 6-7</code> for no-stall and Oye spectrogram references.</li>
            <li>Replace the rigid-case work-per-cycle reference from <code>Figure 10</code> to <code>Figure 3</code>.</li>
          </ul>
          <div class="template">
            <div class="template-head">
              <strong>Paste-ready wording (cross-reference cleanup)</strong>
              <button class="copy-btn" data-copy="en-tpl-1">Copy</button>
            </div>
            <textarea id="en-tpl-1" readonly>... limits the generalisability of the findings; these implications are discussed in Section 6 (Limitations). The no-stall and Oye baseline spectra are shown in Appendix A.4 (Figures 6-7). The results for the rigid prescribed-motion case are shown in Figure 3.</textarea>
          </div>
        </article>

        <article class="item">
          <h3>1.2) Correct abstract citation mapping</h3>
          <p class="meta"><strong>Location:</strong> p.2 Abstract (<code>flexible open source data [1]</code>).</p>
          <ul>
            <li>Change the flexible dataset citation from <code>[1]</code> to your dataset source (currently <code>[14]</code> in Methods).</li>
          </ul>
          <div class="template">
            <div class="template-head">
              <strong>Paste-ready wording (abstract citation line)</strong>
              <button class="copy-btn" data-copy="en-tpl-2">Copy</button>
            </div>
            <textarea id="en-tpl-2" readonly>... and flexible open-source aeroelastic simulation data [14]. The IAG model yields the lowest peak \(C_L\) error (0.592 versus 0.839 for the static case), while the static polar gives the lowest \(C_D\) RMSE (0.107).</textarea>
          </div>
        </article>

        <article class="item">
          <h3>1.3) Unify work-per-cycle sign convention and damping interpretation</h3>
          <p class="meta"><strong>Locations:</strong> Section 3.6 (Eq. 15), Figure 3, Section 4.2, Conclusion.</p>
          <ul>
            <li>Add one explicit sign convention sentence immediately after Eq. (15).</li>
            <li>If Figure 3 y-axis is currently labeled <code>Negative Damping</code>, rename it to <code>Work per cycle, W (non-dimensional)</code> and draw a dashed \(W=0\) line.</li>
            <li>Separate rigid and flexible conclusions into distinct sentences to avoid contradiction.</li>
          </ul>
          <div class="template">
            <div class="template-head">
              <strong>Paste-ready wording (sign convention)</strong>
              <button class="copy-btn" data-copy="en-tpl-3">Copy</button>
            </div>
            <textarea id="en-tpl-3" readonly>We define \(W>0\) as net aerodynamic energy input to the prescribed pitch motion (negative aerodynamic damping), and \(W<0\) as net energy removal (positive damping). Angles are treated in radians when evaluating the integral.</textarea>
          </div>
          <div class="template">
            <div class="template-head">
              <strong>Paste-ready wording (rigid vs flexible bridge)</strong>
              <button class="copy-btn" data-copy="en-tpl-4">Copy</button>
            </div>
            <textarea id="en-tpl-4" readonly>In the rigid prescribed-motion case (Figure 3), \(W\) remains [near zero / same sign] across models, indicating [no / limited] negative damping under these assumptions. In the aeroelastic dataset (Figure 8), BL shows \(W>0\) at high wind speed, while IAG remains at \(W\le0\) because of its amplitude-limiting formulation.</textarea>
          </div>
        </article>

        <article class="item">
          <h3>1.4) Add reproducibility details for the prescribed excitation setup</h3>
          <p class="meta"><strong>Location:</strong> end of Section 3.3 or immediately before Section 3.6.</p>
          <p class="meta"><strong>Why:</strong> your current text says prescribed sinusoidal motion, but does not give \(\alpha(t)\), \(\Delta t\), run length, or cycle-selection rule.</p>
          <div class="template">
            <div class="template-head">
              <strong>Paste-ready wording (reproducibility block)</strong>
              <button class="copy-btn" data-copy="en-tpl-5">Copy</button>
            </div>
            <textarea id="en-tpl-5" readonly>The prescribed motion is \(\alpha(t)=\bar{\alpha}+A\sin(2\pi f_e t)\), with \(\bar{\alpha}=18.5^\circ\) and \(A=10.4^\circ\) to match the OSU benchmark case. Simulations use \(\Delta t=[...]\), duration \(T_{total}=[...]\), and all error metrics are computed over the final cycle after transients.</textarea>
          </div>
        </article>

        <article class="item">
          <h3>1.5) Fix visible language and reference defects</h3>
          <ul>
            <li>p.8: <code>conditions..</code> -&gt; <code>conditions.</code></li>
            <li>p.8: <code>component is remains governed</code> -&gt; <code>component remains governed</code></li>
            <li>p.8: <code>10%The</code> -&gt; <code>10%. The</code></li>
            <li>p.4: <code>8 &lt; α &lt; 29.</code> -&gt; include degree units (<code>8° &lt; α &lt; 29°</code>)</li>
            <li>Ref [21]: <code>Constractor</code> -&gt; <code>Contractor</code></li>
            <li>Ref [20]: verify and correct Theodorsen bibliographic year/source metadata</li>
          </ul>
        </article>
      </section>

      <section class="section priority-should" id="en-recommended">
        <h2>Recommended Improvements <span class="tag should">SCORE UPLIFT</span></h2>
        <p class="meta">These changes make the model recommendation feel engineering-driven rather than descriptive.</p>

        <article class="item">
          <h3>2.1) State explicit model-selection criteria in Conclusion</h3>
          <p class="meta"><strong>Location:</strong> first paragraph of Section 6 Conclusion.</p>
          <div class="template">
            <div class="template-head">
              <strong>Paste-ready wording (decision criteria sentence)</strong>
              <button class="copy-btn" data-copy="en-tpl-6">Copy</button>
            </div>
            <textarea id="en-tpl-6" readonly>Overall model preference is based on (i) peak-load fidelity in deep stall, (ii) robustness under aeroelastic coupling (broadband growth and sign of \(W\)), and (iii) practical stability for long time-domain simulations.</textarea>
          </div>
        </article>

        <article class="item">
          <h3>2.2) Add one simple quantitative spectral metric</h3>
          <ul>
            <li><strong>Option A:</strong> broadband energy ratio = non-harmonic band energy / total energy.</li>
            <li><strong>Option B:</strong> FFT harmonic ratios (for example \(A_{2f_e}/A_{f_e}\), \(A_{3f_e}/A_{f_e}\) for \(C_L\) and \(C_D\)).</li>
          </ul>
          <p class="meta">One numeric comparison (for BL vs IAG at 30 m/s) is enough to move STFT discussion from qualitative to quantitative evidence.</p>
        </article>
      </section>

      <section class="section priority-plus" id="en-optional">
        <h2>Optional High-Value Add-ons <span class="tag plus">IF TIME ALLOWS</span></h2>
        <article class="item">
          <h3>3.1) Add a one-page DNV decision matrix</h3>
          <p class="meta">Summarise each model against hysteresis fidelity, peak loads, \(W\)-sign risk, broadband tendency, and recommended use-case.</p>
        </article>
        <article class="item">
          <h3>3.2) Disclose IAG gating and amplitude-limiting values</h3>
          <p class="meta">You already state qualitative sensitivity; adding numeric threshold/ratio values will remove reproducibility ambiguity.</p>
        </article>
      </section>

      <section class="section" id="en-checklist">
        <h2>Final Submission Checklist</h2>
        <ol>
          <li>Remove all unresolved references (<code>Section ??</code>, wrong appendix figure references, wrong figure number in Section 4.2).</li>
          <li>Align Eq. (15) sign convention, Figure 3 axis/zero line, and Conclusion wording about negative damping.</li>
          <li>Correct abstract dataset citation and clean spacing/formatting artifacts.</li>
          <li>Add the prescribed-excitation reproducibility block (\(\alpha(t)\), \(\Delta t\), total run time, final-cycle rule).</li>
          <li>Clean fast language/reference defects and rerun cross-reference checks before export.</li>
        </ol>
        <div class="note">Extra scan note: Appendix A.7 language quality is noticeably weaker than the main body; a quick grammar pass there will improve overall finish.</div>
      </section>

      <textarea id="full-en" hidden readonly>UPDATED BILINGUAL CORRECTION GUIDE FOR MDM3___DNV (15)

Core story status
- The report narrative is close to complete, but three breaks remain: damping-sign consistency, rigid/flexible evidence separation, and cross-reference reliability.

Must-fix (high priority)
1.1 Resolve placeholder/cross-reference errors:
- p.5 "Section ??"
- p.11 "Appendix A.8" (should reference Appendix A.4, Figures 6-7)
- p.10 "Figure 10" in rigid-case paragraph (should be Figure 3)

1.2 Correct abstract citation and wording:
- "flexible open source data [1]" should point to dataset reference [14]
- fix compressed text formatting around numeric values

1.3 Unify W-sign and damping interpretation:
- define W>0 / W<0 once after Eq. (15)
- relabel Figure 3 axis as work per cycle, add W=0 line
- separate rigid and flexible conclusions into explicit sentences

1.4 Add reproducibility details:
- alpha(t) equation, timestep, total duration, final-cycle evaluation rule

1.5 Fast language/reference cleanup:
- conditions..
- component is remains governed
- 10%The
- add degree symbols to 8<alpha<29
- Constractor -> Contractor
- verify Theodorsen bibliographic metadata

Recommended
2.1 Add explicit model-selection criteria sentence in Conclusion.
2.2 Add one quantitative spectral metric (broadband ratio or harmonic ratios).

Optional
3.1 Add a one-page DNV decision matrix table.
3.2 Report IAG gating/amplitude-limiting numeric values for reproducibility.

Paste-ready templates included in page:
1) Cross-reference cleanup
2) Abstract citation line
3) Eq. (15) sign convention
4) Rigid vs flexible bridge sentences
5) Reproducibility block
6) Conclusion decision criteria sentence</textarea>
    </main>

    <!-- Chinese Pane -->
    <main id="pane-zh" class="lang-pane">
      <section class="section" id="zh-at-a-glance">
        <h2>一页总览</h2>
        <div class="overview-grid">
          <article class="overview-card">
            <p class="overview-k">必改项</p>
            <p class="overview-v">5 组高优先级</p>
          </article>
          <article class="overview-card">
            <p class="overview-k">建议改进</p>
            <p class="overview-v">2 组提分动作</p>
          </article>
          <article class="overview-card">
            <p class="overview-k">可选加分</p>
            <p class="overview-v">2 组高价值补充</p>
          </article>
          <article class="overview-card">
            <p class="overview-k">可复制模板</p>
            <p class="overview-v">6 段可直接粘贴</p>
          </article>
        </div>
        <div class="note">覆盖检查：本页已包含你给出的全部 2026-02-11 修订意见，并补充了我对 <code>MDM3___DNV (15).pdf</code> 的新增问题扫描结果。</div>
      </section>

      <section class="section" id="zh-overall">
        <h2>总体评价</h2>
        <p>你们的主线已经接近闭环，但还有 3 个关键断点会削弱说服力。</p>
        <ul>
          <li><strong>断点 A（阻尼符号）：</strong>\(W\) 的符号定义、图轴命名、正文结论还没有完全统一。</li>
          <li><strong>断点 B（刚性 vs 柔性）：</strong>部分段落把 rigid 结果和 flexible 数据集结果写在同一句里，容易被误读。</li>
          <li><strong>断点 C（交叉引用）：</strong><code>Section ??</code>、<code>Appendix A.8</code>、错误图号等硬错误会直接拉低可信度。</li>
        </ul>
        <p>优先把这三类问题修完，整份报告的技术可信度会显著上升。</p>
      </section>

      <section class="section" id="zh-rescan">
        <h2>复扫确认结果</h2>
        <p class="meta"><strong>页码说明：</strong>本页统一使用两套页码：查看器页码与页脚页码，写法为 <code>PDF p.X (footer p.Y)</code>。这份文档通常满足 <code>Y = X - 2</code>（因为封面和 Abstract 不计入页脚编号）。</p>
        <p class="meta"><strong>扫描范围：</strong>对 <code>MDM3___DNV (15).pdf</code> 做了第二轮逐页文本核查。</p>
        <p class="meta"><strong>可由文本直接确认的问题：</strong></p>
        <ul>
          <li>p.5 仍有 <code>Section??</code> 占位符。</li>
          <li>p.11 仍把频谱基线指向 <code>Appendix A.8</code>（应改到 Appendix A.4 对应图）。</li>
          <li>p.10 Section 4.2 的 rigid 段仍写 <code>Figure 10</code>（语境上应是 Figure 3）。</li>
          <li>p.2 Abstract 仍写 flexible data <code>[1]</code>，与正文数据源不一致。</li>
          <li>p.8 仍有显性语病：<code>conditions..</code>、<code>component is remains governed</code>、<code>10%The</code>。</li>
          <li>Ref [21] 仍有 <code>Constractor</code> 拼写错误。</li>
        </ul>
        <p class="meta"><strong>已移除的不确定告警：</strong>之前关于 Abstract 数字“粘连”的提示已删除，因为该项无法稳定通过视觉复核确认。</p>
        <p class="meta"><strong>需人工看图确认（文本无法判断）：</strong></p>
        <ul>
          <li>Figure 3 y 轴是否仍是 "Negative Damping"，以及是否缺少 \(W=0\) 参考线。</li>
          <li>Figure 2-4 图注是否仍过于相似、信息不足。</li>
          <li>work-per-cycle 图是否仍存在坐标轴裁切。</li>
        </ul>
      </section>

      <section class="section priority-must" id="zh-must">
        <h2>必改项 <span class="tag must">高优先级</span></h2>
        <p class="meta">建议先做完这一部分；这些问题会直接影响评分中的 Presentation、Scientific Argumentation 和 Technical Content。</p>

        <article class="item">
          <h3>1.1）清理占位符与交叉引用错误</h3>
          <p class="meta"><strong>位置：</strong>p.5（<code>Section ??</code>）、p.11（<code>Appendix A.8</code>）、p.10（rigid 段落里写成 <code>Figure 10</code>）。</p>
          <ul>
            <li><code>Section ??</code> 改成真实章节（建议指向 Conclusion/Limitations 段）。</li>
            <li><code>Appendix A.8</code> 改成 <code>Appendix A.4, Figures 6-7</code>。</li>
            <li>p.10 rigid 工况图引用改为 <code>Figure 3</code>。</li>
          </ul>
          <div class="template">
            <div class="template-head">
              <strong>可直接粘贴（交叉引用修正）</strong>
              <button class="copy-btn" data-copy="zh-tpl-1">复制</button>
            </div>
            <textarea id="zh-tpl-1" readonly>... limits the generalisability of the findings; these implications are discussed in Section 6 (Limitations). The no-stall and Oye baseline spectra are shown in Appendix A.4 (Figures 6-7). The results for the rigid prescribed-motion case are shown in Figure 3.</textarea>
          </div>
        </article>

        <article class="item">
          <h3>1.2）修正 Abstract 的数据集引用</h3>
          <p class="meta"><strong>位置：</strong>p.2 Abstract（<code>flexible open source data [1]</code>）。</p>
          <ul>
            <li>柔性数据应引用你们的方法章节数据源（当前是 [14]），不是 [1]。</li>
          </ul>
          <div class="template">
            <div class="template-head">
              <strong>可直接粘贴（Abstract 引用句）</strong>
              <button class="copy-btn" data-copy="zh-tpl-2">复制</button>
            </div>
            <textarea id="zh-tpl-2" readonly>... and flexible open-source aeroelastic simulation data [14]. The IAG model yields the lowest peak \(C_L\) error (0.592 versus 0.839 for the static case), while the static polar gives the lowest \(C_D\) RMSE (0.107).</textarea>
          </div>
        </article>

        <article class="item">
          <h3>1.3）统一 Work per cycle 与负阻尼的符号定义</h3>
          <p class="meta"><strong>位置：</strong>Section 3.6（Eq.15）、Figure 3、Section 4.2、Conclusion。</p>
          <ul>
            <li>Eq.15 后明确写一次 \(W&gt;0\) / \(W&lt;0\) 物理意义。</li>
            <li>如果 Figure 3 当前 y 轴确实写成 <code>Negative Damping</code>，建议改为 <code>Work per cycle, W (non-dimensional)</code> 并加 \(W=0\) 虚线。</li>
            <li>把 rigid 与 flexible 的结论拆开写，避免前后句冲突。</li>
          </ul>
          <div class="template">
            <div class="template-head">
              <strong>可直接粘贴（符号定义句）</strong>
              <button class="copy-btn" data-copy="zh-tpl-3">复制</button>
            </div>
            <textarea id="zh-tpl-3" readonly>We define \(W>0\) as net aerodynamic energy input to the prescribed pitch motion (negative aerodynamic damping), and \(W<0\) as net energy removal (positive damping). Angles are treated in radians when evaluating the integral.</textarea>
          </div>
          <div class="template">
            <div class="template-head">
              <strong>可直接粘贴（rigid/flexible 桥接句）</strong>
              <button class="copy-btn" data-copy="zh-tpl-4">复制</button>
            </div>
            <textarea id="zh-tpl-4" readonly>In the rigid prescribed-motion case (Figure 3), \(W\) remains [near zero / same sign] across models, indicating [no / limited] negative damping under these assumptions. In the aeroelastic dataset (Figure 8), BL shows \(W>0\) at high wind speed, while IAG remains at \(W\le0\) because of its amplitude-limiting formulation.</textarea>
          </div>
        </article>

        <article class="item">
          <h3>1.4）补上可复现性最关键的输入与数值设置</h3>
          <p class="meta"><strong>位置：</strong>Section 3.3 末或 3.6 前。</p>
          <p class="meta"><strong>建议：</strong>写出 \(\alpha(t)\)、\(\Delta t\)、总时长、以及“误差取最后一周期”的规则。</p>
          <div class="template">
            <div class="template-head">
              <strong>可直接粘贴（可复现性段落）</strong>
              <button class="copy-btn" data-copy="zh-tpl-5">复制</button>
            </div>
            <textarea id="zh-tpl-5" readonly>The prescribed motion is \(\alpha(t)=\bar{\alpha}+A\sin(2\pi f_e t)\), with \(\bar{\alpha}=18.5^\circ\) and \(A=10.4^\circ\) to match the OSU benchmark case. Simulations use \(\Delta t=[...]\), duration \(T_{total}=[...]\), and all error metrics are computed over the final cycle after transients.</textarea>
          </div>
        </article>

        <article class="item">
          <h3>1.5）快速修正显眼语病与参考文献瑕疵</h3>
          <ul>
            <li>p.8：<code>conditions..</code> -&gt; <code>conditions.</code></li>
            <li>p.8：<code>component is remains governed</code> -&gt; <code>component remains governed</code></li>
            <li>p.8：<code>10%The</code> -&gt; <code>10%. The</code></li>
            <li>p.4：<code>8 &lt; α &lt; 29.</code> 建议补单位（<code>8° &lt; α &lt; 29°</code>）</li>
            <li>Ref [21]：<code>Constractor</code> -&gt; <code>Contractor</code></li>
            <li>Ref [20]：核对 Theodorsen 的年份与条目信息（当前高度可疑）</li>
          </ul>
        </article>
      </section>

      <section class="section priority-should" id="zh-recommended">
        <h2>建议改进项 <span class="tag should">显著提分</span></h2>
        <p class="meta">这部分不是“硬伤”，但会让结论更像工程决策而不是纯描述。</p>

        <article class="item">
          <h3>2.1）在 Conclusion 明确模型推荐的判据</h3>
          <p class="meta"><strong>位置：</strong>Section 6 开头段落。</p>
          <div class="template">
            <div class="template-head">
              <strong>可直接粘贴（决策判据句）</strong>
              <button class="copy-btn" data-copy="zh-tpl-6">复制</button>
            </div>
            <textarea id="zh-tpl-6" readonly>Overall model preference is based on (i) peak-load fidelity in deep stall, (ii) robustness under aeroelastic coupling (broadband growth and sign of \(W\)), and (iii) practical stability for long time-domain simulations.</textarea>
          </div>
        </article>

        <article class="item">
          <h3>2.2）给频域分析加一个轻量定量指标</h3>
          <ul>
            <li><strong>选项 A：</strong>Broadband energy ratio（非谐波频带能量 / 总能量）。</li>
            <li><strong>选项 B：</strong>FFT 谐波幅值比（如 \(A_{2f_e}/A_{f_e}\), \(A_{3f_e}/A_{f_e}\)）。</li>
          </ul>
          <p class="meta">只要补一个 BL vs IAG 的数值对比（30 m/s）就能把“看图判断”升级为“定量证据”。</p>
        </article>
      </section>

      <section class="section priority-plus" id="zh-optional">
        <h2>可选加分项 <span class="tag plus">有余力再做</span></h2>
        <article class="item">
          <h3>3.1）增加一页 DNV 决策矩阵</h3>
          <p class="meta">按 hysteresis 准确性、峰值载荷、\(W\) 符号风险、broadband 趋势、建议使用场景做结构化汇总。</p>
        </article>
        <article class="item">
          <h3>3.2）公开 IAG 的 gating/limiting 数值</h3>
          <p class="meta">你们目前只写了“趋势不变”，补上阈值与比例会显著增强可复现性。</p>
        </article>
      </section>

      <section class="section" id="zh-checklist">
        <h2>提交前自检</h2>
        <ol>
          <li>先修完所有交叉引用硬错误（<code>Section ??</code>、错误 appendix 引用、错误图号）。</li>
          <li>统一 Eq.(15)-Figure 3-Conclusion 对 \(W\) 正负号与负阻尼的定义。</li>
          <li>修正 Abstract 数据集引用（使其与正文数据源一致）。</li>
          <li>补上 \(\alpha(t)\)、\(\Delta t\)、总时长与最后周期评估规则。</li>
          <li>快速清语病、拼写与参考文献信息后再导出最终版。</li>
        </ol>
        <div class="note">额外扫描提示：Appendix A.7 的语言质量明显弱于正文，建议单独做一次语法和符号一致性清理。</div>
      </section>

      <textarea id="full-zh" hidden readonly>MDM3___DNV (15) 新版网页修正指南（中英双语）

核心判断
- 报告主线基本成型，但存在 3 个断点：阻尼符号不统一、rigid/flexible 结论混写、交叉引用硬错误。

必改项（高优先级）
1.1 修正 Section?? / Appendix A.8 / Figure 10 等错误引用
1.2 修正 Abstract 中 flexible dataset 引用（[1] -> [14]）
1.3 统一 W 正负号定义、Figure 3 轴命名、Results/Conclusion 结论
1.4 补可复现性设置：alpha(t)、dt、总时长、最后周期规则
1.5 快速修语病与参考文献瑕疵（conditions.., 10%The, Constractor 等）

建议改进
2.1 明确模型推荐判据（峰值、耦合稳健性、时域稳定性）
2.2 给 STFT/FFT 补一个轻量定量指标（broadband ratio 或 harmonic ratio）

可选加分
3.1 增加一页 DNV 决策矩阵表
3.2 给出 IAG gating/limiting 具体数值

页面内置 6 段可直接复制英文模板：
1) 交叉引用修正
2) Abstract 引用句
3) Eq.(15) 符号定义
4) rigid/flexible 桥接句
5) 可复现性段落
6) Conclusion 判据句</textarea>
    </main>

      </div>
    </div>

    <aside id="source-dock" class="source-dock" aria-hidden="true">
      <div class="source-dock-head">
        <div class="source-dock-head-text">
          <p id="dock-kicker" class="source-dock-kicker">Floating Source Dock</p>
          <h4 id="dock-title" class="source-dock-title">Current Template Source</h4>
          <p id="dock-note" class="source-dock-note">Auto-follows the section nearest to the viewport while scrolling.</p>
        </div>
        <div class="source-dock-actions">
          <button id="dock-copy" class="btn-primary">Copy Source</button>
          <button id="dock-close">Close</button>
        </div>
      </div>
      <pre id="dock-code" class="source-dock-code"></pre>
    </aside>

    <footer id="footer-text">Best compatibility: modern browsers over HTTPS. If clipboard access is blocked, select the target text and press Cmd/Ctrl+C.</footer>
  </div>

  <script>
    const state = {
      lang: 'en',
      dockOpen: false,
      dockCurrentId: '',
      dockCurrentText: '',
      dockRafPending: false
    };

    const i18n = {
      en: {
        heroTitle: 'DNV Feedback',
        heroSubtitle: 'MDM3___DNV (15).pdf',
        toggle: '切换中文',
        sourceToggleOpen: 'Open Floating Source Dock',
        sourceToggleClose: 'Hide Floating Source Dock',
        githubStar: 'Star on GitHub',
        footer: 'Best compatibility: modern browsers over HTTPS. If clipboard access is blocked, select the target text and press Cmd/Ctrl+C.',
        ready: 'Ready.',
        copiedTemplate: (n) => `Copied template ${n}.`,
        dockKicker: 'Floating Source Dock',
        dockTitlePrefix: 'Current Template Source',
        dockNote: 'Auto-follows the section nearest to the viewport while scrolling.',
        dockCopy: 'Copy Source',
        dockClose: 'Close',
        dockCopied: 'Copied current source.',
        dockOpened: 'Floating source dock opened.',
        dockClosed: 'Floating source dock closed.',
        dockEmpty: 'No source available in this view.',
        blocked: 'Clipboard blocked. Target text selected; press Cmd/Ctrl+C.',
        templateLabel: 'Template'
      },
      zh: {
        heroTitle: 'DNV反馈',
        heroSubtitle: 'MDM3___DNV (15).pdf',
        toggle: 'Switch to English',
        sourceToggleOpen: '打开源码悬浮窗',
        sourceToggleClose: '关闭源码悬浮窗',
        githubStar: '去 GitHub 点个 Star',
        footer: '建议在 HTTPS 浏览器中使用。若复制权限被拦截，请选中文本后按 Cmd/Ctrl+C。',
        ready: '已就绪。',
        copiedTemplate: (n) => `已复制模板 ${n}。`,
        dockKicker: '源码悬浮窗',
        dockTitlePrefix: '当前模板源码',
        dockNote: '滚动页面时会自动跟随当前可视区域附近的模板段落。',
        dockCopy: '复制源码',
        dockClose: '关闭',
        dockCopied: '已复制当前源码。',
        dockOpened: '已打开源码悬浮窗。',
        dockClosed: '已关闭源码悬浮窗。',
        dockEmpty: '当前视图暂无可用源码。',
        blocked: '浏览器限制了剪贴板访问，已选中文本，请按 Cmd/Ctrl+C。',
        templateLabel: '模板'
      }
    };

    const statusEl = document.getElementById('status');
    const heroTitleEl = document.getElementById('hero-title');
    const heroSubtitleEl = document.getElementById('hero-subtitle');
    const langToggleEl = document.getElementById('lang-toggle');
    const sourceToggleEl = document.getElementById('source-toggle');
    const githubStarLinkEl = document.getElementById('github-star-link');
    const githubStarTextEl = document.getElementById('github-star-text');
    const dockEl = document.getElementById('source-dock');
    const dockKickerEl = document.getElementById('dock-kicker');
    const dockTitleEl = document.getElementById('dock-title');
    const dockNoteEl = document.getElementById('dock-note');
    const dockCopyEl = document.getElementById('dock-copy');
    const dockCloseEl = document.getElementById('dock-close');
    const dockCodeEl = document.getElementById('dock-code');
    const footerEl = document.getElementById('footer-text');

    function setStatus(message, kind = '') {
      statusEl.textContent = message;
      statusEl.className = `status ${kind}`.trim();
    }

    async function copyText(text) {
      if (navigator.clipboard && window.isSecureContext) {
        await navigator.clipboard.writeText(text);
        return true;
      }
      return false;
    }

    function activePane() {
      return document.getElementById(`pane-${state.lang}`);
    }

    function activeTemplates() {
      return [...activePane().querySelectorAll('.template textarea')];
    }

    function typesetMath(scope = document) {
      if (window.MathJax && typeof window.MathJax.typesetPromise === 'function') {
        return window.MathJax.typesetPromise([scope]).catch(() => {});
      }
      return Promise.resolve();
    }

    function enhanceTemplateRendering() {
      document.querySelectorAll('.template').forEach((template) => {
        if (template.dataset.enhanced === '1') return;
        const source = template.querySelector('textarea');
        if (!source) return;

        const preview = document.createElement('div');
        preview.className = 'latex-preview';
        preview.textContent = source.value;

        const sourceWrap = document.createElement('div');
        sourceWrap.className = 'source-wrap';

        template.insertBefore(preview, source);
        template.insertBefore(sourceWrap, source);
        sourceWrap.appendChild(source);
        template.dataset.enhanced = '1';
      });
    }

    function listActiveTemplateEntries() {
      return [...activePane().querySelectorAll('.template')].map((template, index) => {
        const source = template.querySelector('textarea');
        const title = template.querySelector('.template-head strong')?.textContent?.trim()
          || `${i18n[state.lang].templateLabel} ${index + 1}`;
        return source ? { template, source, title, index } : null;
      }).filter(Boolean);
    }

    function pickClosestVisibleTemplate(entries) {
      if (!entries.length) return null;
      const anchorY = Math.min(180, window.innerHeight * 0.28);
      let best = null;
      let bestScore = Number.POSITIVE_INFINITY;

      entries.forEach((entry) => {
        const rect = entry.template.getBoundingClientRect();
        if (rect.bottom < 0 || rect.top > window.innerHeight) return;
        const score = Math.abs(rect.top - anchorY);
        if (score < bestScore) {
          bestScore = score;
          best = entry;
        }
      });

      if (best) return best;
      return entries.find((entry) => entry.template.getBoundingClientRect().top >= 0) || entries[entries.length - 1];
    }

    function updateDockContent(entry, force = false) {
      const t = i18n[state.lang];
      if (!entry) {
        state.dockCurrentId = '';
        state.dockCurrentText = '';
        dockTitleEl.textContent = t.dockTitlePrefix;
        dockCodeEl.textContent = '';
        return;
      }

      if (!force && state.dockCurrentId === entry.source.id) return;
      state.dockCurrentId = entry.source.id;
      state.dockCurrentText = entry.source.value;
      dockTitleEl.textContent = `${t.dockTitlePrefix}: ${entry.title}`;
      dockCodeEl.textContent = entry.source.value;
    }

    function refreshDockByViewport(force = false) {
      if (!state.dockOpen) return;
      const entries = listActiveTemplateEntries();
      const target = pickClosestVisibleTemplate(entries);
      updateDockContent(target, force);
    }

    function scheduleDockRefresh() {
      if (!state.dockOpen) return;
      if (state.dockRafPending) return;
      state.dockRafPending = true;
      requestAnimationFrame(() => {
        state.dockRafPending = false;
        refreshDockByViewport();
      });
    }

    function setDockOpen(open) {
      state.dockOpen = open;
      dockEl.classList.toggle('open', open);
      dockEl.setAttribute('aria-hidden', open ? 'false' : 'true');
      sourceToggleEl.textContent = open ? i18n[state.lang].sourceToggleClose : i18n[state.lang].sourceToggleOpen;
      if (open) {
        refreshDockByViewport(true);
        setStatus(i18n[state.lang].dockOpened, 'ok');
      } else {
        setStatus(i18n[state.lang].dockClosed);
      }
    }

    function switchLanguage(lang) {
      state.lang = lang;

      document.getElementById('pane-en').classList.toggle('active', lang === 'en');
      document.getElementById('pane-zh').classList.toggle('active', lang === 'zh');
      document.getElementById('map-en').classList.toggle('active', lang === 'en');
      document.getElementById('map-zh').classList.toggle('active', lang === 'zh');

      const t = i18n[lang];
      heroTitleEl.innerHTML = t.heroTitle;
      heroSubtitleEl.textContent = t.heroSubtitle;
      langToggleEl.textContent = t.toggle;
      sourceToggleEl.textContent = state.dockOpen ? t.sourceToggleClose : t.sourceToggleOpen;
      githubStarTextEl.textContent = t.githubStar;
      githubStarLinkEl.setAttribute('aria-label', t.githubStar);
      dockKickerEl.textContent = t.dockKicker;
      dockNoteEl.textContent = t.dockNote;
      dockCopyEl.textContent = t.dockCopy;
      dockCloseEl.textContent = t.dockClose;
      footerEl.textContent = t.footer;
      setStatus(t.ready);
      document.documentElement.lang = lang === 'en' ? 'en' : 'zh-CN';
      typesetMath(activePane());
      if (state.dockOpen) {
        refreshDockByViewport(true);
      } else {
        dockTitleEl.textContent = t.dockTitlePrefix;
      }
    }

    async function copyFromTextarea(textarea, copiedMsg) {
      const t = i18n[state.lang];
      try {
        const ok = await copyText(textarea.value);
        if (ok) {
          setStatus(copiedMsg, 'ok');
        } else {
          const fallback = document.createElement('textarea');
          fallback.value = textarea.value;
          fallback.style.position = 'fixed';
          fallback.style.left = '-9999px';
          document.body.appendChild(fallback);
          fallback.focus();
          fallback.select();
          setStatus(t.blocked, 'warn');
          setTimeout(() => fallback.remove(), 1500);
        }
      } catch (_) {
        const fallback = document.createElement('textarea');
        fallback.value = textarea.value;
        fallback.style.position = 'fixed';
        fallback.style.left = '-9999px';
        document.body.appendChild(fallback);
        fallback.focus();
        fallback.select();
        setStatus(t.blocked, 'warn');
        setTimeout(() => fallback.remove(), 1500);
      }
    }

    document.addEventListener('click', (e) => {
      const btn = e.target.closest('.copy-btn');
      if (!btn) return;
      const target = document.getElementById(btn.dataset.copy);
      if (!target) return;
      const templates = activeTemplates();
      const idx = templates.findIndex((x) => x.id === target.id);
      const n = idx >= 0 ? idx + 1 : '?';
      copyFromTextarea(target, i18n[state.lang].copiedTemplate(n));
    });

    langToggleEl.addEventListener('click', () => {
      switchLanguage(state.lang === 'en' ? 'zh' : 'en');
    });

    sourceToggleEl.addEventListener('click', () => {
      setDockOpen(!state.dockOpen);
    });

    dockCloseEl.addEventListener('click', () => {
      setDockOpen(false);
    });

    dockCopyEl.addEventListener('click', async () => {
      const text = state.dockCurrentText || dockCodeEl.textContent || '';
      if (!text.trim()) {
        setStatus(i18n[state.lang].dockEmpty, 'warn');
        return;
      }

      try {
        const ok = await copyText(text);
        if (ok) {
          setStatus(i18n[state.lang].dockCopied, 'ok');
        } else {
          const fallback = document.createElement('textarea');
          fallback.value = text;
          fallback.style.position = 'fixed';
          fallback.style.left = '-9999px';
          document.body.appendChild(fallback);
          fallback.focus();
          fallback.select();
          setStatus(i18n[state.lang].blocked, 'warn');
          setTimeout(() => fallback.remove(), 1500);
        }
      } catch (_) {
        const fallback = document.createElement('textarea');
        fallback.value = text;
        fallback.style.position = 'fixed';
        fallback.style.left = '-9999px';
        document.body.appendChild(fallback);
        fallback.focus();
        fallback.select();
        setStatus(i18n[state.lang].blocked, 'warn');
        setTimeout(() => fallback.remove(), 1500);
      }
    });

    window.addEventListener('scroll', scheduleDockRefresh, { passive: true });
    window.addEventListener('resize', scheduleDockRefresh);

    enhanceTemplateRendering();
    switchLanguage('en');
    window.addEventListener('load', () => {
      typesetMath(document);
      refreshDockByViewport(true);
    });
  </script>
</body>
</html>
